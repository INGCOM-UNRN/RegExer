/**
 * REGEXER.JS - JavaScript for RegExer
 *
 * @package RegExer
 * @version 1.1b
 *
 * @author Pavel
 * @copyright Pavel Meliantchenkov
 */
var RegExer=function(c){var e,f,h,a,l,b,B,t,m,q,d,k,p,s=[],v=[],y="undefined"!==typeof CSSC,C=!1,z="match",D=function(){y?(CSSC("#"+l.getAttribute("id")).set("height",b.offsetHeight+"px"),CSSC("#"+m.getAttribute("id")).set("height",b.offsetHeight+"px")):(l.style.height=b.offsetHeight+"px",m.style.height=b.offsetHeight+"px")},A=function(d){if(f.value){try{B=new RegExp(f.value,"g");t=new RegExpGrpPos(B,!0);for(var g=t.match(l.value),a,c,e=new formatedString(l.value),n=0;n<g.length;n++){a=g[n];c=n%2?
"b":"a";e.addOpt(a[0][1],'<span class="f '+c+" n"+n+'">');e.addOpt(a[0][1]+a[0][0].length,"</span>");for(var r=1;r<a.length;r++)e.addOpt(a[r][1],'<span class="g '+c+" n"+r+'">'),e.addOpt(a[r][1]+a[r][0].length,"</span>")}b.innerHTML="<span>"+e.getFormText(!0)+"&nbsp;</span>";y?CSSC("textarea#"+f.getAttribute("id")).set("border-color","#ccc"):f.style.borderColor="#ccc";h.innerHTML=encode(f.value)+"&nbsp;";var k=f.value;s=[[0,k.length]];v=[0];var p,g=0;c=a=!1;for(var w=0;w<k.length;w++){p=k[w];if("\\"!=
k[w-1])c=!0;else if("("==p||")"==p){c=!1;for(var u=w-2;0<=u;u--)if("\\"===k[u])c=!c;else break}if(c&&"("==p)s.push([w,null]),g=s.length-1;else if(c&&")"==p)for(a=!1,g=0,u=s.length-1;0<=u;u--)if(null===s[u][1])if(a){g=u;break}else s[u][1]=w,a=!0;v[w+1]=g}"replace"===z&&(m.value=l.value.replace(B,q.value));if(y){e=new formatedString(f.value);k={};for(n=1;n<s.length;n++)for(r=0;r<s[n].length;r++)k[s[n][r]]?k[s[n][r]].push(n):k[s[n][r]]=[n];for(n in k)for(r=0;r<k[n].length;r++)e.addOpt(n,'<span class="hg_cssc gn'+
k[n][r]+'">'),e.addOpt(parseInt(n)+1,"</span>");h.innerHTML=e.getFormText(!0)+"&nbsp;"}C=!1}catch(x){console.log(x),y?CSSC("textarea#"+f.getAttribute("id")).set("border-color","#f00"):f.style.borderColor="#f00",C=!0}d&&(b.scrollTop=this.scrollTop)}},x=null,E=function(){if(!C){var a=f.selectionStart;if(y){for(var g=1;g<=s.length;g++)CSSC(".g.n"+g).set("background-color","rgba(0, 0, 0, 0)"),CSSC(".hg_cssc.gn"+g).set("background-color","transparent");CSSC(".g.n"+v[a]).set("background-color","rgba(0, 0, 0, 0.2)");
CSSC(".hg_cssc.gn"+v[a]).set("background-color","#ffecb3")}else{for(var d=b.getElementsByClassName("g"),g=0;g<d.length;g++)d[g].classList.remove("s");if(v[a]){d=b.getElementsByClassName("g n"+v[a]);for(g=0;g<d.length;g++)d[g].classList.add("s");(a=0<v[a]?s[v[a]]:null)&&x!==a?(g=new formatedString(f.value),g.addOpt(a[0],'<span class="hg">'),g.addOpt(a[0]+1,"</span>"),g.addOpt(a[1],'<span class="hg">'),g.addOpt(a[1]+1,"</span>"),h.innerHTML=g.getFormText(!0)+"&nbsp;",x=a):x!==a&&(h.innerHTML=f.value+
"&nbsp;",x=a)}else null!==x&&(h.innerHTML=encode(f.value)+"&nbsp;",x=null)}}},F=function(b){if("match"==b||"replace"==b){k.setAttribute("class","");p.setAttribute("class","");var g=p;"match"==b&&(g=k);g.classList.add("sel");e.setAttribute("class",b);a.setAttribute("class",b);D();z=b;A()}};c=c?"string"===typeof c?document.getElementById(c):c:document.body;e=document.createElement("div");e.setAttribute("id","regexer_input");f=document.createElement("textarea");f.setAttribute("id","regexer_input_input");
h=document.createElement("pre");h.setAttribute("id","regexer_input_pre");a=document.createElement("div");a.setAttribute("id","regexer_text");l=document.createElement("textarea");l.setAttribute("id","regexer_text_txt");b=document.createElement("pre");b.setAttribute("id","regexer_text_pre");m=document.createElement("textarea");m.setAttribute("id","regexer_replace_txt");m.setAttribute("readonly","readonly");q=document.createElement("input");q.setAttribute("id","regexer_input_replace");q.setAttribute("type",
"text");d=document.createElement("div");d.setAttribute("id","regex_controll");k=document.createElement("a");k.setAttribute("id","regex_controll_match");"match"===z&&k.setAttribute("class","sel");k.innerHTML="match";d.appendChild(k);p=document.createElement("a");p.setAttribute("id","regex_controll_replace");"replace"===z&&k.setAttribute("class","sel");p.innerHTML="replace";d.appendChild(p);c.appendChild(d);c.appendChild(e);e.appendChild(f);e.appendChild(h);e.appendChild(q);c.appendChild(a);a.appendChild(l);
a.appendChild(b);a.appendChild(m);D();(function(){var a=function(a){var b=!1;40>=a.keyCode&&13!==a.keyCode&&8!==a.keyCode&&9!==a.keyCode&&32!==a.keyCode||112<=a.keyCode&&150>=a.keyCode||91===a.keyCode||92===a.keyCode||(A(),b=!0);E();return b};l.addEventListener("scroll",function(){b.scrollTop=this.scrollTop});l.addEventListener("change",function(){b.innerHTML="<span>"+encode(this.value)+"</span>\n";b.scrollTop=this.scrollTop;A()});l.addEventListener("keyup",function(b){a(b)});f.addEventListener("scroll",
function(){h.scrollTop=this.scrollTop});f.addEventListener("change",function(){h.scrollTop=this.scrollTop});f.addEventListener("keyup",function(b){h.scrollTop=this.scrollTop;a(b)});q.addEventListener("keyup",function(b){a(b)});f.addEventListener("click",function(a){E()});p.addEventListener("click",function(){F("replace")});k.addEventListener("click",function(){F("match")});window.addEventListener("resize",function(){D()})})();(f&&f.innerHTML||l&&l.innerHTML)&&A()},RegExpGrpPos=function(c,e){var f=
null,h=!!e,a=function(a){var b=[],c=0,e=a.index,m,q;b[0]=[a[0],h?e:c];for(var d=1;d<a.length;d++)m=f[d-1]?f[d-1][0]:0,q=f[d-2]?f[d-2][0]:0,m>q?c=h?b[d-1][1]-e:b[d-1][1]:m<q&&(c=h?b[d-1][1]+b[d-1][0].length-e:b[d-1][1]+b[d-1][0].length),a[d]?(c=a[0].indexOf(a[d],c),b[d]=[a[d],h?c+e:c],c+=a[d].length):b[d]=["",h?c+e:c];return b};this.match=function(e){for(var b=c.toString(),h=[],t=0,m,q=!1,d=0;d<b.length;d++)if(m=b[d],"("===m&&"\\"!==b[d-1])t++,h.push([t,d]);else if(")"===m&&"\\"!==b[d-1])t--;else if(("("===
m||")"===m)&&"\\"===b[d-1]){for(var q=!1,k=d-2;-1<k;k--)if("\\"===b[k])q=!q;else break;q&&"("===m?(t++,h.push([t,d])):q&&")"===m&&t--}f=0===t?h:!1;for(var p,b=null,h=[];null!==(p=c.exec(e))&&b!==p.index;)h.push(a(p)),b=p.index;return h};this.setPositionAbsolute=function(a){h=!!a}},formatedString=function(c){var e={},f=function(c){return c.replace(/[\x26\x0A\x3c\x3e\x22\x27]/g,function(a){return"&#"+a.charCodeAt(0)+";"})};this.addOpt=function(c,a){e[c]||(e[c]=[]);e[c].push(a)};this.getOpts=function(){return e};
this.getOrgText=function(){return c};this.getFormText=function(h){var a=0,l="",b;for(b in e){l=h?l+f(c.substr(a,b-a)):l+c.substr(a,b-a);for(a=0;a<e[b].length;a++)l+=e[b][a];a=b}return l=h?l+f(c.substr(a)):l+c.substr(a)}},encode=function(c){return c.replace(/[\x26\x0A\x3c\x3e\x22\x27]/g,function(c){return"&#"+c.charCodeAt(0)+";"})};
